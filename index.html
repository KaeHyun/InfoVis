<!DOCTYPE html>

<!-- 
    [ 6주차 pdf ]
    1) d3.select(selectorString)selects the first element that matches selectorString 
    2) d3.selectAll(selectorString) selects all elements that match selectorString
    3) selection.attr(name, value) sets the name attribute of the elements in selectionto value.
    4) selection.style(name, value) sets the name CSS property of the elements in selectionto value.
    5) selection.text(value) sets the text insidethe elements in selectionto value
    6) selection.append(tagName)adds a tagNameelement to each element in selection and returns a selection of the added element(s)


-->

<html lang="en">
    <head>
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">

        <title>TWITCH DATA</title>
        <style>
             body {
            background: #eee;
        }

        .container {
            width: 100%;
            max-width: 8000px;
            background: white;
        }

        </style>
        <script src="https://d3js.org/d3.v7.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/d3-legend/2.25.6/d3-legend.min.js"></script>

        
        <nav class="container navbar navbar-light bg-light">
            <a class="navbar-brand" href="#">
                <img src="./pngwing.com.png" width="70" height="40" class="d-inline-block align-top" alt="">
                <span style="font-family: 'Consolas'; font-size: 24px; font-weight: bold; ">
                    Surf the Twitch Data
                </span>
              </a>
        </nav>

    </head>

    <body>
        <div id="chart"></div>

        <script>
            d3.csv("https://raw.githubusercontent.com/KaeHyun/InfoVis/master/twitchdata-update.csv")
            .then(twitchData =>{
                console.log(twitchData.length);
                console.log(twitchData[0]);
                
                // 데이터 전처리
                twitchData.forEach(d => {
                    d.followers = +d.Followers;
                });
                // 차트 크기 설정
                const width = 800;
                const height = 400;
                const legendBoxSize = 10; // 인덱스 상자 크기
                const legendBoxPadding = 5; // 인덱스 상자 간 간격
                const legendRows = 6; // 인덱스 상자 행 개수
                const legendColumns = 3; // 인덱스 상자 열 개수

                // SVG 요소 생성
                const svg = d3.select("#chart")
                    .append("svg")
                    .attr("width", width)
                    .attr("height", height);
                // 언어별 팔로워 수 그룹화
                const languageData = d3.rollups(twitchData, v => d3.sum(v, d => d.followers), d => d.Language);

                // 팔로워 수를 기준으로 Y 축 스케일 설정
                const yScale = d3.scaleLinear()
                .domain([0, d3.max(languageData, d => d[1])])
                .range([height, 0]);

                // 색상 척도 설정
                const colorScale = d3.scaleOrdinal(d3.schemePastel1)
                .domain(languageData.map(d => d[0]));

                 // 막대 그래프 그리기
                svg.selectAll("rect")
                .data(languageData)
                .enter()
                .append("rect")
                .attr("x", (d, i) => i * (width / languageData.length))
                .attr("y", d => yScale(d[1]))
                .attr("width", width / languageData.length - 1)
                .attr("height", d => height - yScale(d[1]))
                .attr("fill", d => colorScale(d[0]));
                
                // 언어 레이블 추가
                svg.selectAll(".language-label")
                .data(languageData)
                .enter()
                .append("text")
                .attr("class", "language-label")
                .attr("x", (d, i) => i * (width / languageData.length) + (width / languageData.length - 10) / 2);
                
                // 인덱스 상자 그리기
                const legend = svg.selectAll(".legend")
                .data(languageData)
                .enter()
                .append("g")
                .attr("class", "legend")
                .attr("transform", (d, i) => "translate(" + (width - 100 + (i % legendColumns) * 70) + "," + (Math.floor(i / legendColumns) * 30) + ")"); // 인덱스 상자 위치 조정

                legend.append("rect")
                .attr("x", 0)
                .attr("y", 0)
                .attr("width", legendBoxSize)
                .attr("height", legendBoxSize)
                .style("fill", d => colorScale(d[0]));

                legend.append("text")
                .attr("x", legendBoxSize + legendBoxPadding)
                .attr("y", legendBoxSize + legendBoxPadding)
                .text(d => d[0]);


                // Y 축 그리기
                const yAxis = d3.axisLeft(yScale);
                svg.append("g")
                .call(yAxis);

            });

            /* Javascript and d3 here */
            
        </script>

    </body>




</html>