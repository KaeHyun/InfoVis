<!DOCTYPE html>

<html lang="en">
    <head>
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <script src="https://d3js.org/d3.v7.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/d3-legend/2.25.6/d3-legend.min.js"></script>
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css" integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous">
        <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ho+j7jyWK8fNQe+A12Hb8AhRq26LrZ/JpcUGGOn+Y7RsweNrtN/tE3MoK7ZeZDyx" crossorigin="anonymous"></script>
        <script src="https://unpkg.com/@popperjs/core@2"></script>
        

        <!-- components 속 js 파일들 -->
        <script src = "components/scatterPlot.js"></script>
        <script src = "components/zoomCircles.js"></script>


        <title>TWITCH DATA</title>
        <style>
             body {
            background: #eee;
        }

        .container {
            width: 100%;
            max-width: 8000px;
            background: white;
        }

        .form-select
        {
            background: #7E7E82;
            border-color: #eee;
            border-radius: 5%;
            margin-left: 10px;
            color: white;
            height: 40px;
            width: 220px;
            box-shadow: inset;
            text-align: center;
        }

        </style>

    </head>

    <body>

        <nav class="container navbar navbar-light bg-light">
            <a class="navbar-brand" href="#">
                <img src="./pngwing.com.png" width="70" height="40" class="d-inline-block align-top" alt="">
                <span style="font-family: 'Consolas'; font-size: 24px; font-weight: bold; ">
                    Surf the Twitch Data
                </span>
              </a>
        </nav>
        <main class="container pb-3">
        <div class="select">
          <select class="form-select" id="first-lang" aria-label="Default select example">
            <option selected>Select First Language</option>
            <option value="All">All</option>
            <option value="English">English</option>
            <option value="Portuguese">Portuguese</option>
            <option value="German">German</option>
            <option value="Korean">Korean</option>
            <option value="Russian">Russian</option>
            <option value="Japanese">Japanese</option>
            <option value="Czech">Czech</option>
            <option value="Turkish">Turkish</option>
            <option value="Polish">Polish</option>
            <option value="Thai">Thai</option>
          </select>

          <select class="form-select" id="second-lang" aria-label="Default select example">
            <option selected>Select Second Language</option>
            <option value="All">All</option>
            <option value="English">English</option>
            <option value="Portuguese">Portuguese</option>
            <option value="German">German</option>
            <option value="Korean">Korean</option>
            <option value="Russian">Russian</option>
            <option value="Japanese">Japanese</option>
            <option value="Czech">Czech</option>
            <option value="Turkish">Turkish</option>
            <option value="Polish">Polish</option>
            <option value="Thai">Thai</option>
          </select>
        </div>

          <div class="row pt-2" style="margin-left: 10px; margin-bottom: 2px;">
            <div class="col-1 text-end pe-2"><strong>X :</strong></div>
            <div class="col-11"  style="margin-left: -40px;">
                <div class="form-check form-check-inline">
                    <input class="form-check-input" type="radio" name="x-encoding" value="Followers gained" id="x-sw" checked>
                    <label class="form-check-label" for="x-sw">Followers gained</label>
                </div>
                <div class="form-check form-check-inline">
                    <input class="form-check-input" type="radio" name="x-encoding" value="Peak viewers" id="x-pw">
                    <label class="form-check-label" for="x-pw">Peak viewers</label>
                </div>
                <div class="form-check form-check-inline">
                    <input class="form-check-input" type="radio" name="x-encoding" value="Stream time(minutes)" id="x-pw">
                    <label class="form-check-label" for="x-pw">Stream time(minutes)</label>
                </div>
            </div>
        </div>
        <div class="row" style="margin-left: 10px;">
            <div class="col-1 text-end pe-2"><strong>Y :</strong></div>
            <div class="col-11" style="margin-left: -40px;">
                <div class="form-check form-check-inline">
                    <input class="form-check-input" type="radio" name="y-encoding" value="Followers gained" id="y-sw" checked>
                    <label class="form-check-label" for="x-sw">Followers gained</label>
                </div>
                <div class="form-check form-check-inline">
                    <input class="form-check-input" type="radio" name="y-encoding" value="Peak viewers" id="y-pw">
                    <label class="form-check-label" for="x-pw">Peak viewers</label>
                </div>
                <div class="form-check form-check-inline">
                    <input class="form-check-input" type="radio" name="y-encoding" value="Stream time(minutes)" id="y-pw">
                    <label class="form-check-label" for="x-pw">Stream time(minutes)</label>
                </div>
            </div>
        </div>

        <!-- 산점도 차트 -->
        <div class="playground">
            <svg width="700" height="700" id="scatterchart"></svg>
            <div class="tooltip bs-tooltip-top show" id="sc-tooltip" role="tooltip" style="display:none">
                <div class="tooltip-arrow"></div>
                <div class="tooltip-inner">
                    Some tooltip text!
                </div>
            </div>
        </div>
        <div id="zoomCircle" ></div>
    </main>

        <script>

            let scatterPlot;

            function updateScatter()
            {
                let xAxis= d3.select("input[type=radio][name=x-encoding]:checked").property("value");
                let yAxis = d3.select("input[type=radio][name=y-encoding]:checked").property("value");
                let firstLanguage = d3.select("#first-lang").property("value");
                let secondLanguage = d3.select("#second-lang").property("value");
                scatterPlot.update(firstLanguage, secondLanguage, xAxis, yAxis);
            }


            d3.csv("https://raw.githubusercontent.com/KaeHyun/InfoVis/master/twitchdata-update.csv")
            .then(twitchData =>{

                //ScatterPlot 객체 생성
                scatterPlot = new ScatterPlot("#scatterchart", "#sc-tooltip",twitchData);
                
                //초기화
                scatterPlot.initialize();

                updateScatter();

                d3.selectAll("input[type=radio][name=x-encoding]").on("change", updateScatter);
                d3.selectAll("input[type=radio][name=y-encoding]").on("change", updateScatter);
                d3.select("#first-lang").on("change", updateScatter);
                d3.select("#second-lang").on("change", updateScatter);
            
            // 초기값으로 전체 선택
            scatterPlot.update("English", "English", "Views gained", "Views gained");

            });

            /* Javascript and d3 here */
            
        </script>

    </body>

</html>